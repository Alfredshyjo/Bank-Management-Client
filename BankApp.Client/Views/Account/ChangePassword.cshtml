@using BankApp.Client.ViewModels
@model ChangePasswordViewModel

@{
    ViewData["Title"] = "Change Password";
}

<div class="container mt-3">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card shadow-lg border-0">
                <!-- Header -->
                <div class="card-header text-white text-center py-3">
                    <i class="fas fa-shield-alt fa-lg mb-1"></i>
                    <h5 class="mb-0 fw-bold">Change Password</h5>
                    <small style="opacity: 0.9;">Keep your account secure</small>
                </div>

                <!-- Body -->
                <div class="card-body p-3">
                    <form asp-action="ChangePassword" method="post" id="changePasswordForm">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger alert-sm border-0 py-2" role="alert"></div>

                        <!-- Current Password -->
                        <div class="mb-3">
                            <label asp-for="CurrentPassword" class="form-label small fw-semibold">
                                <i class="fas fa-lock"></i> Current Password
                            </label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-light">
                                    <i class="fas fa-key text-muted"></i>
                                </span>
                                <input asp-for="CurrentPassword"
                                       type="password"
                                       class="form-control"
                                       id="currentPassword"
                                       placeholder="Enter current password"
                                       autocomplete="current-password" />
                                <button class="btn btn-outline-secondary toggle-password"
                                        type="button"
                                        data-target="#currentPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="CurrentPassword" class="text-danger small"></span>
                        </div>

                        <!-- New Password -->
                        <div class="mb-3">
                            <label asp-for="NewPassword" class="form-label small fw-semibold">
                                <i class="fas fa-lock"></i> New Password
                            </label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-light">
                                    <i class="fas fa-key text-muted"></i>
                                </span>
                                <input asp-for="NewPassword"
                                       type="password"
                                       class="form-control"
                                       id="newPassword"
                                       placeholder="Enter new password"
                                       autocomplete="new-password" />
                                <button class="btn btn-outline-secondary toggle-password"
                                        type="button"
                                        data-target="#newPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="NewPassword" class="text-danger small"></span>
                        </div>

                        <!-- Confirm Password -->
                        <div class="mb-3">
                            <label asp-for="ConfirmPassword" class="form-label small fw-semibold">
                                <i class="fas fa-check-double"></i> Confirm New Password
                            </label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-light">
                                    <i class="fas fa-key text-muted"></i>
                                </span>
                                <input asp-for="ConfirmPassword"
                                       type="password"
                                       class="form-control"
                                       id="confirmPassword"
                                       placeholder="Re-enter new password"
                                       autocomplete="new-password" />
                                <button class="btn btn-outline-secondary toggle-password"
                                        type="button"
                                        data-target="#confirmPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                        </div>

                        <!-- Password Requirements - Compact -->
                        @* <div class="alert alert-info border-0 py-2 mb-3" role="alert">
                            <small>
                                <i class="fas fa-info-circle me-1"></i>
                                <strong>Requirements:</strong> 8+ chars, uppercase, lowercase, number, special char
                            </small>
                        </div> *@

                        <!-- Submit Buttons -->
                        <div class="row g-2">
                            <div class="col-7">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-check-circle me-1"></i> Update Password
                                </button>
                            </div>
                            <div class="col-5">
                                <a href="javascript:history.back()"
                                   class="btn btn-outline-secondary w-100">
                                    <i class="fas fa-times me-1"></i> Cancel
                                </a>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Footer -->
                <div class="card-footer bg-light text-center py-2">
                    <small class="text-muted">
                        <i class="fas fa-shield-alt text-success"></i>
                        Your password is encrypted and secure
                    </small>
                </div>
            </div>

            
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function() {
            // Password strength indicator
            $('#newPassword').on('input', function() {
                const password = $(this).val();
                let strength = 0;

                if (password.length >= 8) strength++;
                if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
                if (/\d/.test(password)) strength++;
                if (/[^a-zA-Z0-9]/.test(password)) strength++;

                // Remove existing indicator
                $('.password-strength').remove();

                if (password.length > 0) {
                    let strengthText = '';
                    let strengthClass = '';

                    if (strength < 2) {
                        strengthText = 'Weak';
                        strengthClass = 'text-danger';
                    } else if (strength < 3) {
                        strengthText = 'Fair';
                        strengthClass = 'text-warning';
                    } else if (strength < 4) {
                        strengthText = 'Good';
                        strengthClass = 'text-info';
                    } else {
                        strengthText = 'Strong';
                        strengthClass = 'text-success';
                    }

                    $(this).parent().parent().after(
                        `<small class="password-strength ${strengthClass} mt-1 d-block">
                            <i class="fas fa-shield-alt"></i> <strong>${strengthText}</strong>
                        </small>`
                    );
                }
            });

            // Confirm password match validation
            $('#confirmPassword').on('input', function() {
                const newPassword = $('#newPassword').val();
                const confirmPassword = $(this).val();

                $('.password-match').remove();

                if (confirmPassword.length > 0) {
                    if (newPassword === confirmPassword) {
                        $(this).parent().parent().after(
                            `<small class="password-match text-success mt-1 d-block">
                                <i class="fas fa-check-circle"></i> Passwords match
                            </small>`
                        );
                        $(this).removeClass('is-invalid').addClass('is-valid');
                    } else {
                        $(this).parent().parent().after(
                            `<small class="password-match text-danger mt-1 d-block">
                                <i class="fas fa-times-circle"></i> Passwords do not match
                            </small>`
                        );
                        $(this).removeClass('is-valid').addClass('is-invalid');
                    }
                }
            });

            // Form submission handling
            $('#changePasswordForm').on('submit', function(e) {
                const btn = $(this).find('button[type="submit"]');
                btn.prop('disabled', true);
                btn.html('<i class="fas fa-spinner fa-spin me-1"></i> Updating...');

                // Re-enable after 3 seconds in case of validation errors
                setTimeout(function() {
                    btn.prop('disabled', false);
                    btn.html('<i class="fas fa-check-circle me-1"></i> Update Password');
                }, 3000);
            });
        });
    </script>
}
